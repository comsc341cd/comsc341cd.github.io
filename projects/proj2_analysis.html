
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Project 2 Part 2: Analysis &#8212; COMSC341-CD: Causal Inference for Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=a37d84e8" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'projects/proj2_analysis';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Project 3 üíâ" href="proj3.html" />
    <link rel="prev" title="Project 2 Part 1: Functions" href="proj2_functions.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">COMSC341-CD: Causal Inference for Data Science</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Causal Inference for Data Science
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Syllabus</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus/values.html">Goals and Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syllabus/policies.html">Course Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syllabus/schedule.html">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syllabus/office_hours.html">Office Hours</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../resources/submit.html">How to Run and Submit</a></li>


<li class="toctree-l1"><a class="reference internal" href="../resources/catalog.html">Causal Catalog</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Activities</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../activities/activities.html">In-Class Activities</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Worksheets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../worksheets/ws1.html">Worksheet 1 üé≤</a></li>






<li class="toctree-l1"><a class="reference internal" href="../worksheets/ws2.html">Worksheet 2 üêº</a></li>






<li class="toctree-l1"><a class="reference internal" href="../worksheets/ws3.html">Worksheet 3 üìä</a></li>







<li class="toctree-l1"><a class="reference internal" href="../worksheets/ws4.html">Worksheet 4 üìà</a></li>







<li class="toctree-l1"><a class="reference internal" href="../worksheets/ws5.html">Worksheet 5 üå±</a></li>







<li class="toctree-l1"><a class="reference internal" href="../worksheets/ws6.html">Worksheet 6 ü§ñ</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="proj1.html">Project 1 üë∂</a></li>
<li class="toctree-l1"><a class="reference internal" href="proj2.html">Project 2 üë•</a></li>

<li class="toctree-l1"><a class="reference internal" href="proj3.html">Project 3 üíâ</a></li>

<li class="toctree-l1"><a class="reference internal" href="final_project.html">Final Project üåç</a></li>






</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://comsc341cd-hub-sp.mtholyoke.edu/hub/user-redirect/git-pull?repo=https%3A//github.com/comsc341cd/comsc341cd.github.io&urlpath=tree/comsc341cd.github.io/projects/proj2_analysis.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/projects/proj2_analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Project 2 Part 2: Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Project 2 Part 2: Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-table-of-contents-and-rubric">Part 2 Table of Contents and Rubric</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-and-function-imports">Notebook and function imports</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-study-effects-of-trimming">1. Simulation study: effects of trimming</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lalonde-study">The Lalonde Study</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prior-knowledge-and-causal-question">Prior Knowledge and Causal Question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation">Estimation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2. Prior Knowledge and Causal Question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">3. Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-and-interpretation">4. Estimation and Interpretation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reflection">5. Reflection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-extensions">Optional Extensions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="project-2-part-2-analysis">
<span id="proj2-analysis"></span><h1>Project 2 Part 2: Analysis<a class="headerlink" href="#project-2-part-2-analysis" title="Link to this heading">#</a></h1>
<blockquote class="epigraph">
<div><p>Observational Studies</p>
<p class="attribution">‚ÄîTODO your name here</p>
</div></blockquote>
<div class="admonition-collaboration-statement admonition">
<p class="admonition-title">Collaboration Statement</p>
<ul class="simple">
<li><p>TODO brief statement on the nature of your collaboration.</p></li>
<li><p>TODO your collaborator‚Äôs names here</p></li>
</ul>
</div>
<section id="part-2-table-of-contents-and-rubric">
<h2>Part 2 Table of Contents and Rubric<a class="headerlink" href="#part-2-table-of-contents-and-rubric" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Section</p></th>
<th class="head"><p>Points</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Visualizing trimming effects</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>Study design: Lalonde</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>Estimation and interpretation: Lalonde</p></td>
<td><p>1.5</p></td>
</tr>
<tr class="row-odd"><td><p>Reflection</p></td>
<td><p>0.5</p></td>
</tr>
<tr class="row-even"><td><p>Total</p></td>
<td><p>5 pts</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Grading guidelines</p>
<p>The course projects offer an opportunity to practice the full causal inference workflow, from building estimators and formulating questions to conducting analyses and communicating your findings effectively. Here are some guidelines on how to approach the project:</p>
<ul class="simple">
<li><p>For visualizations:</p>
<ul>
<li><p>Help your reader understand your findings through visually clear figures</p></li>
<li><p>Label your axes, provide legends when appropriate, and add figure titles to provide context</p></li>
</ul>
</li>
<li><p>For written responses:</p>
<ul>
<li><p>Support your ideas with specific evidence from your analysis or prior knowledge</p></li>
<li><p>Write concisely but clearly ‚Äì one-word/one-phrase answers usually don‚Äôt give enough space to show what you‚Äôve learned</p></li>
</ul>
</li>
</ul>
<p>If you‚Äôre uncertain about any portion of the project, please do come to office hours, TA hours, or reach out on Ed!</p>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="notebook-and-function-imports">
<h1>Notebook and function imports<a class="headerlink" href="#notebook-and-function-imports" title="Link to this heading">#</a></h1>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you click on the vertical blue bar on the left of a cell, you can collapse the code which can help organize the notebook as you work through the project.</p>
</div>
<p>If you have tested your implementation in Part 1 against the autograder, you would have generated a file called <code class="docutils literal notranslate"><span class="pre">proj2_functions.py</span></code>. Let‚Äôs now import those functions into this notebook for use in Part 2.</p>
<p>If you are running this notebook on the JupyterHub allocated for the course:</p>
<ol class="arabic simple">
<li><p>Open the file browser by going to the menu bar ‚ÄúView -&gt; File Browser‚Äù</p></li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">comsc341cd.github.io/projects/</span></code>, you should see your <code class="docutils literal notranslate"><span class="pre">proj2_analysis.ipynb</span></code> file in that folder</p></li>
<li><p>Click on the upload button in the upper right and upload the <code class="docutils literal notranslate"><span class="pre">proj2_functions.py</span></code> file to this directory</p></li>
<li><p>Run the following cell to import the functions</p></li>
</ol>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>

<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact_manual</span>

<span class="kn">from</span> <span class="nn">proj2_functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact_manual</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">proj2_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;proj2_functions&#39;
</pre></div>
</div>
</div>
</details>
</div>
<p>We have provided implementations of <code class="docutils literal notranslate"><span class="pre">bootstrap_ci</span></code> and <code class="docutils literal notranslate"><span class="pre">bootstrap_dfs</span></code> from Project 1, as well as <code class="docutils literal notranslate"><span class="pre">reg_diff_in_means</span></code> which uses linear regression to estimate difference-in-means below:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The fact that our matching estimator matches <strong>without</strong> replacment is critical for making our bootstrap confidence intervals valid. For the statistically curious, you can see <a class="reference external" href="https://pmc.ncbi.nlm.nih.gov/articles/PMC4260115/">Austin and Small 2014: The use of bootstrapping when using propensity-score matching without replacement: a simulation study</a> for a detailed exploration of why.</p>
</div>
<div class="cell tag_hide_code tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap_ci</span><span class="p">(</span><span class="n">bootstrap_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the confidence interval using the percentile method.</span>

<span class="sd">    Args:</span>
<span class="sd">        bootstrap_values (list[float]): the bootstrapped values</span>
<span class="sd">        alpha (float): the significance level, defaults to 0.05</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[float]: the confidence interval [lower, upper]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_values</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_values</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">bootstrap_dfs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_bootstraps</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bootstraps the dataframe `n_bootstraps` times.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): the dataframe to bootstrap</span>
<span class="sd">        n_bootstraps (int): the number of bootstraps to generate</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[pd.DataFrame]: a list of bootstrapped dataframes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bootstrap_dfs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstraps</span><span class="p">):</span>
        <span class="n">bootstrap_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">bootstrap_dfs</span>


<span class="k">def</span> <span class="nf">reg_diff_in_means</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outcome_col</span><span class="p">,</span> <span class="n">treat_col</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the difference in means between the treatment and control groups using a regression model.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.DataFrame): the dataframe containing the data</span>
<span class="sd">        outcome_col (str): the name of the outcome variable</span>
<span class="sd">        treat_col (str): the name of the treatment variable</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: the difference in means between the treatment and control groups</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reg_result</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1"> ~ 1 + </span><span class="si">{</span><span class="n">treat_col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">reg_result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">treat_col</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We have also provided a helper function called <code class="docutils literal notranslate"><span class="pre">generate_estimates()</span></code> that will compute both the point estimate and bootstrapped confidence interval for any estimator function you pass to it. Read through the docstring and the code below to make sure you understand how it works:</p>
<div class="cell tag_hide_code tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_estimates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">estimator_func</span><span class="p">,</span> <span class="n">treat_col</span><span class="p">,</span> <span class="n">outcome_col</span><span class="p">,</span> <span class="n">n_bootstraps</span><span class="o">=</span><span class="mi">2000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the point estimate the and bootstrapped 95% confidence interval for an estimator function.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.DataFrame): the dataframe containing the data</span>
<span class="sd">        estimator_func (function): the estimator function to use</span>
<span class="sd">        treat_col (str): the name of the treatment variable</span>
<span class="sd">        outcome_col (str): the name of the outcome variable</span>
<span class="sd">        n_bootstraps (int): the number of bootstraps to use</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: a dictionary containing the point estimate, bootstrapped confidence interval, and bootstrapped values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute the point estimate</span>
    <span class="n">point_estimate</span> <span class="o">=</span> <span class="n">estimator_func</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">treat_col</span><span class="o">=</span><span class="n">treat_col</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="n">outcome_col</span><span class="p">)</span>
    
    <span class="c1"># generate the bootstrap samples</span>
    <span class="n">bootstrap_samples</span> <span class="o">=</span> <span class="n">bootstrap_dfs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_bootstraps</span><span class="p">)</span>
    <span class="c1"># compute the bootstrap estimates</span>
    <span class="n">bootstrap_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">bootstrap_sample</span> <span class="ow">in</span> <span class="n">bootstrap_samples</span><span class="p">:</span>
        <span class="n">bootstrap_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator_func</span><span class="p">(</span><span class="n">bootstrap_sample</span><span class="p">,</span> <span class="n">treat_col</span><span class="o">=</span><span class="n">treat_col</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="n">outcome_col</span><span class="p">))</span>
    
    <span class="c1"># compute the confidence interval, which is a list of two floats</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="n">bootstrap_ci</span><span class="p">(</span><span class="n">bootstrap_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;point_estimate&#39;</span><span class="p">:</span> <span class="n">point_estimate</span><span class="p">,</span> <span class="s1">&#39;ci&#39;</span><span class="p">:</span> <span class="n">ci</span><span class="p">,</span> <span class="s1">&#39;bootstrap_values&#39;</span><span class="p">:</span> <span class="n">bootstrap_values</span><span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>For example, if we had a dataset <code class="docutils literal notranslate"><span class="pre">df</span></code> with treatment column <code class="docutils literal notranslate"><span class="pre">T</span></code> and outcome column <code class="docutils literal notranslate"><span class="pre">Y</span></code>, we could compute the point estimate and 95% confidence interval for the difference-in-means estimator as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">diff_in_means_results</span> <span class="o">=</span> <span class="n">generate_estimates</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">estimator_func</span><span class="o">=</span><span class="n">reg_diff_in_means</span><span class="p">,</span> <span class="n">treat_col</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="simulation-study-effects-of-trimming">
<h1>1. Simulation study: effects of trimming<a class="headerlink" href="#simulation-study-effects-of-trimming" title="Link to this heading">#</a></h1>
<p>We provide a simulated observational study dataset in <code class="docutils literal notranslate"><span class="pre">~/COMSC-341CD/data/sim_observational_study.csv</span></code>, with a true ATT of 1, and the true propensity score given by the <code class="docutils literal notranslate"><span class="pre">propensity_score</span></code> column.</p>
<p>Complete the widget below to explore the effect of trimming the propensity score on the balance and estimate distribution. The <code class="docutils literal notranslate"><span class="pre">plot_balance_and_estimate_distribution()</span></code> function will generate three plots on one row:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">axs[0]</span></code> will show the overlap in the propensity score distribution between the treated and control groups in the trimmed dataset</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">axs[1]</span></code> will show the overlap in the propensity score distribution between the treated and control groups in the trimmed dataset after matching has been performed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">axs[2]</span></code> will show the distribution of the ATT estimate for the matched dataset, compared to the true ATT of 1</p></li>
</ul>
<p>Be sure to label the axes and add a title to each plot.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO add an interact_manual decorator for lower_bound and upper_bound, in increments of 0.1</span>
<span class="c1"># @interact_manual(TODO)</span>
<span class="k">def</span> <span class="nf">plot_balance_and_estimate_distributions</span><span class="p">(</span><span class="n">lower_bound</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the trimmed distribution, matched distribution, and the ATT estimate distribution for a dataset given a lower and upper bound trimming of the propensity score.</span>

<span class="sd">    Args:</span>
<span class="sd">        lower_bound (float): the lower bound of the propensity score</span>
<span class="sd">        upper_bound (float): the upper bound of the propensity score</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">lower_bound</span> <span class="o">&lt;</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="s2">&quot;Lower bound must be less than upper bound&quot;</span>

    <span class="c1"># Load in the simulated dataset, note that is already has a &#39;propensity_score&#39; column</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;~/COMSC-341CD/data/sim_observational_study.csv&quot;</span><span class="p">)</span>

    <span class="c1"># TODO trim the data_df with the lower and upper bounds</span>
    <span class="c1"># trimmed_df = None</span>
    <span class="c1"># TODO match the trimmed dataset</span>
    <span class="c1"># matched_df = None</span>
    <span class="c1"># TODO generate results for the matched dataset</span>
    <span class="c1"># matched_results = generate_estimates(data=TODO, estimator_func=reg_diff_in_means, treat_col=&#39;T&#39;, outcome_col=&#39;Y&#39;)</span>

    <span class="c1"># generate 3 plots on one row</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1">#### axs[0] ####</span>
    <span class="c1"># TODO plot the propensity score distribution of trimmed_df on axs[0], where x=&#39;propensity_score&#39; and hue=&#39;T&#39;</span>
    <span class="c1"># sns.kdeplot(TODO)</span>

    <span class="c1"># fix the x-axis for easier comparison</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


    <span class="c1">#### axs[1] ####</span>
    <span class="c1"># TODO plot the propensity score distribution of matched_df on axs[1], where x=&#39;propensity_score&#39; and hue=&#39;T&#39;</span>
    <span class="c1"># sns.kdeplot(TODO)</span>

    <span class="c1"># fix the x-axis for easier comparison</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


    <span class="c1">#### axs[2] ####</span>
    <span class="c1"># TODO plot the ATT estimate distribution on axs[2] as a histogram, using matched_results[&#39;bootstrap_values&#39;]</span>
    <span class="c1"># sns.histplot(TODO)</span>

    <span class="c1"># TODO plot vertical lines for the estimated ATT using matched_results[&#39;point_estimate&#39;]</span>

    <span class="c1"># TODO plot a vertical line for the true ATT, which is x=1</span>

    <span class="c1"># fix the x-axis for easier comparison</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the bounds are too narrow, the widget may throw an error due to no control units being found for some treated units during matching. That is to be expected, and does not indicate an issue with your code.</p>
</div>
<p>Answer the following questions based on the widget above:</p>
<p>1.1. When there is no trimming (lower_bound = 0 and upper_bound = 1), what do you observe about the ATT estimate (right plot)? Does the estimated effect appear to be biased? Looking at the non-matched propensity score distribution (left plot), what do you observe about potential overlap concerns with the treated and control groups?</p>
<p>1.2. Holding the upper bound constant at 1, what do you observe about the ATT distribution (right plot) and the matched propensity score distribution (middle plot) as you vary the lower bound?</p>
<p>1.3. Holding the lower bound constant at 0, what do you observe about the ATT distribution (right plot) and the matched propensity score distribution (middle plot) as you vary the upper bound?</p>
<p>1.4. Based on the matched propensity score distribution and the ATT distribution, what appears to be a reasonable upper and lower bound for trimming the propensity score?</p>
<p><strong>TODO your responses below</strong>:</p>
<p>1.1.</p>
<p>1.2.</p>
<p>1.3.</p>
<p>1.4.</p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="the-lalonde-study">
<h1>The Lalonde Study<a class="headerlink" href="#the-lalonde-study" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://www.jstor.org/stable/1806062?seq=1">Lalonde (1986)</a> was a landmark study in causal inference, as it aimed to compare non-experimental observational methods of estimating causal effects to those from a randomized experiment. It analyzed data from the National Supported Work Demonstration (NSW) program, where participants across the United States were randomly assigned to the job-training program.</p>
<section id="prior-knowledge-and-causal-question">
<h2>Prior Knowledge and Causal Question<a class="headerlink" href="#prior-knowledge-and-causal-question" title="Link to this heading">#</a></h2>
<p>Below is a description of the NSW program adapted from <a class="reference external" href="https://mixtape.scunning.com/">Cunninngham 2021</a> and <a class="reference external" href="https://www.mdrc.org/sites/default/files/full_249.pdf">Manpower Demonstration Research Corporation 1983</a>:</p>
<blockquote>
<div><p>The National Supported Work Demonstration (NSW) job-training program was operated by the Manpower Demonstration Research Corp (MDRC) in the mid-1970s. The NSW was a temporary employment program designed to help individuals facing employment barriers develop basic job skills and transition into the labor market by providing work experience and counseling in a supportive environment. It was also unique in that it randomly assigned eligible applicants to training positions. The treatment group received all the benefits of the NSW program. The comparison group did not receive these benefits. The program served women receiving Aid to Families with Dependent Children, people in recovery from substance use disorders, formerly incarcerated individuals, and adults who had not completed high school. The sites were located in 15 different locations across the United States:</p>
</div></blockquote>
<div style="max-width:500px; margin: auto;"> 
<p><img alt="" src="../_images/proj2_mdrc_locations.png" /></p>
</div>
<blockquote>
<div><p>Treatment group participants were provided a job for nine to eighteen months depending on the target group and site. They were organized into crews of three to five participants who worked together and met frequently with an NSW counselor to discuss concerns about the program and performance. Additionally, they received compensation for their work. NSW offered the participants initial wages that were lower than standard employment rates, but included opportunities for earnings to increase based on satisfactory performance and attendance. After participants completed their terms, they needed to secure regular employment. The types of jobs varied within sites‚Äîsome worked as gas-station attendants, some worked at a printer shop‚Äîand the work assignments often differed between men and women.</p>
</div></blockquote>
<p>The causal question of interest is whether the National Supported Work Demonstration program (NSW) deployed in 1976-77 had an effect on the participants‚Äô 1978 earnings, and the causal quantity that is targeted is the average treatment effect on the treated (ATT):</p>
<div class="math notranslate nohighlight">
\[
ATT = \mathbb{E}[Y(1) - Y(0) \mid T = 1]
\]</div>
<ul class="simple">
<li><p>treatment <span class="math notranslate nohighlight">\(T\)</span>: whether the participant was in the NSW program</p></li>
<li><p>outcome <span class="math notranslate nohighlight">\(Y\)</span>: the participant‚Äôs earnings in 1978</p></li>
</ul>
<p>Lalonde and subsequent researchers constructed two datasets: an experimental dataset where the treatment was randomly assigned, and an observational dataset built from other national survey data to serve as controls. We can therefore use the experimental dataset to estimate the causal effect of the treatment as the ‚Äútrue‚Äù ATT effect, and use it to compare the performance of our observational methods.</p>
<p>In particular, there are the following variables in the dataset:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">re78</span></code>: <strong>outcome</strong>: the participant‚Äôs <strong>re</strong>al (inflation-adjusted) earnings in 1978</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">treat</span></code>: <strong>treatment</strong>: whether the participant was in the NSW program</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">u74</span></code>: whether the participant was unemployed in 1974</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">u75</span></code>: whether the participant was unemployed in 1975</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">re74</span></code>: the participant‚Äôs real earnings in 1974</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">re75</span></code>: the participant‚Äôs real earnings in 1975</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">black</span></code>: whether the participant is black</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hisp</span></code>: whether the participant is Hispanic</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">marr</span></code>: whether the participant is married</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nodegree</span></code>: whether the participant has a high school degree</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code>: the participant‚Äôs age</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">educ</span></code>: the participant‚Äôs education level as a number of years of schooling (e.g. 12 for high school graudate, 16 for college graduate)</p></li>
</ul>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Link to this heading">#</a></h2>
<p><strong>Figure 1</strong>: Load in the observational dataset and fit a propensity score model to assess positivity and overlap. Complete the code cell below to create two histogram plots side-by-side, where the left plot shows the overall shape of the propensity score distribution, and the right plot zooms in using <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylim.html">axes.set_ylim()</a> to get a better view of overlap.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">observational_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;~/COMSC-341CD/data/nsw_observational.csv&#39;</span><span class="p">)</span>
<span class="n">covariates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;hisp&#39;</span><span class="p">,</span> <span class="s1">&#39;marr&#39;</span><span class="p">,</span> <span class="s1">&#39;nodegree&#39;</span><span class="p">,</span> <span class="s1">&#39;re74&#39;</span><span class="p">,</span> <span class="s1">&#39;re75&#39;</span><span class="p">,</span> <span class="s1">&#39;u74&#39;</span><span class="p">,</span> <span class="s1">&#39;u75&#39;</span><span class="p">]</span>

<span class="c1"># TODO fit propensity score model and create the &#39;propensity_score&#39; column</span>

<span class="c1"># TODO plot two plots side-by-side, where the left plot shows the overall shape of the propensity score distribution, and the right plot zooms in using`ax.set_ylim()` to get a better view of overlap</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Figure 1: Propensity Score Distribution&#39;</span><span class="p">)</span>

<span class="c1">#### axs[0] ####</span>
<span class="c1"># sns.histplot(data=TODO, </span>
<span class="c1">#             x=TODO,</span>
<span class="c1">#             hue=TODO,</span>
<span class="c1">#             ax=TODO,</span>
<span class="c1">#             bins=15, </span>
<span class="c1">#             multiple=&#39;stack&#39;) # this stacks the histograms for easier comparison</span>
<span class="c1"># axs[0].set_title(TODO)</span>

<span class="c1">#### axs[1] ####</span>
<span class="c1"># TODO repeat the same plot as above, but zoom in using set_ylim(0, 100) to get a better view of overlap</span>

<span class="c1"># axs[1].set_ylim(0, 100)</span>
<span class="c1"># axs[1].set_title(TODO)</span>

<span class="c1"># save the figure for viewing later</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fig1_propensity_score_distribution.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6a088f3f6e383c36135ac9655bd687393d3c6ef63c7d1fecab7ca06d855824bc.png" src="../_images/6a088f3f6e383c36135ac9655bd687393d3c6ef63c7d1fecab7ca06d855824bc.png" />
</div>
</details>
</div>
<p>Next, trim the dataset using a lower bound of 0.1 and an upper bound of 1 and then <strong>refit</strong> the propensity score model for the trimmed dataset.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO trim the dataset using a lower bound of 0.1 and an upper bound of 1</span>
<span class="n">trimmed_df</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># TODO refit the propensity score model for the trimmed dataset and update the &#39;propensity_score&#39; column</span>
<span class="c1"># trimmed_df[&#39;propensity_score&#39;] = TODO</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>Figure 2</strong>: Finally, generate two matched datasets: one using the observational dataset, and one using the trimmed dataset. Plot the Love plots for the two matched datasets side by side, fixing their x-axis limits to be the same for easier comparison.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO generate the matched datasets</span>
<span class="c1"># matched_df = TODO</span>
<span class="c1"># matched_trimmed_df = TODO</span>


<span class="c1"># TODO call std_diff_dataframe for the two matched datasets. </span>
<span class="c1"># Be sure to pair matched_df with observational_df, and matched_trimmed_df with trimmed_df</span>
<span class="c1"># observational_std_diff = TODO</span>
<span class="c1"># trimmed_std_diff = TODO</span>

<span class="c1"># TODO plot the Love plots for the two std diff dataframes side by side</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Figure 2: Love Plots&#39;</span><span class="p">)</span>
<span class="c1"># covariates = [&#39;age&#39;, &#39;educ&#39;, &#39;black&#39;, &#39;hisp&#39;, &#39;marr&#39;, &#39;nodegree&#39;, &#39;re74&#39;, &#39;re75&#39;, &#39;u74&#39;, &#39;u75&#39;]</span>

<span class="c1"># TODO for both plots, set the x-axis limits to be the same</span>
<span class="c1"># axs[0].set_title(TODO)</span>
<span class="c1"># axs[0].set_xlim(-2.5, 2.5)</span>

<span class="c1"># axs[1].set_title(TODO)</span>
<span class="c1"># axs[1].set_xlim(-2.5, 2.5)</span>

<span class="c1"># save the figure for viewing later</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fig2_love_plots.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/746581454b2982cdc07080d06e583d384a300316681e9a1a9be6a27af9d6c747.png" src="../_images/746581454b2982cdc07080d06e583d384a300316681e9a1a9be6a27af9d6c747.png" />
</div>
</details>
</div>
</section>
<section id="estimation">
<h2>Estimation<a class="headerlink" href="#estimation" title="Link to this heading">#</a></h2>
<p>Instead of reporting a table of estimates and confidence intervals, for this project we will generate two figures for illustrating the estimates and confidence intervals for the observational and trimmed datasets. We provide a <code class="docutils literal notranslate"><span class="pre">build_estimator_error_bars</span></code> function that helps generate the error bar plots for the various estimators:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_estimator_error_bars</span><span class="p">(</span><span class="n">estimator_dict</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a dictionary of estimator results and an axis, generates the error bar plots for the estimators, </span>
<span class="sd">    where the x-axis is the estimator name, the y-axis is the point estimate, and the error bars are the 95% confidence interval.</span>

<span class="sd">    Args:</span>
<span class="sd">        estimator_dict (dict): A dictionary of estimator results</span>
<span class="sd">        ax (plt.Axes): The axis to plot the error bars on</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (plt.Axes): The axis with the error bars plotted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">est_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">,</span> <span class="s1">&#39;point_estimate&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_ci&#39;</span><span class="p">,</span> <span class="s1">&#39;upper_ci&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">estimator_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">est_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">est_df</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">est_df</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;estimator&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">estimator</span><span class="p">],</span>
            <span class="s1">&#39;point_estimate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;point_estimate&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;lower_ci&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
            <span class="s1">&#39;upper_ci&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">})],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;yerr_lower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;point_estimate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;lower_ci&#39;</span><span class="p">]</span>
    <span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;yerr_upper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;upper_ci&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;point_estimate&#39;</span><span class="p">]</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">est_df</span><span class="p">)),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;point_estimate&#39;</span><span class="p">],</span>
        <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;yerr_lower&#39;</span><span class="p">],</span> <span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;yerr_upper&#39;</span><span class="p">]],</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="c1"># draw a circle at each point</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1"># draw a line at the end of the error bar</span>
        <span class="n">color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># use the first color in the seaborncolor palette</span>
        
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">est_df</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">est_df</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>For example, if we had the following dictionary of estimators:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">estimator_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;estimator1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;point_estimate&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s1">&#39;ci&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;estimator2&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;point_estimate&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;ci&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The function call <code class="docutils literal notranslate"><span class="pre">build_estimator_error_bars(estimator_dict,</span> <span class="pre">ax)</span></code> would generate a plot that looks like this:</p>
<div style="max-width:500px; margin: auto;"> 
<p><img alt="" src="../_images/proj2_example_error_bars.png" /></p>
</div><p>Begin by generating the results for each estimator using the <code class="docutils literal notranslate"><span class="pre">generate_estimates</span></code> helper function provided earlier in the notebook according to the table below:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Results Name</p></th>
<th class="head"><p>estimator_func</p></th>
<th class="head"><p>data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">naive</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">reg_diff_in_means</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">observational_df</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">matching</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">reg_diff_in_means</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">matched_df</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ipw</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ipw_att</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">observational_df</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">naive_trimmed</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">reg_diff_in_means</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">trimmed_df</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">matching_trimmed</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">reg_diff_in_means</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">matched_trimmed_df</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ipw_trimmed</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ipw_att</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">trimmed_df</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO call generate_estimates for each estimator, this cell may take ~20-30 seconds to run</span>
<span class="n">naive</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#generate_estimates(data=observational_df, estimator_func=reg_diff_in_means, treat_col=&#39;treat&#39;, outcome_col=&#39;re78&#39;)</span>
<span class="n">matching</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">ipw</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">naive_trimmed</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">matching_trimmed</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">ipw_trimmed</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>Figure 3</strong>: Build a side by side plot of the estimators for the observational and trimmed datasets. The goal is to produce a plot similar to figure 3 in <a class="reference external" href="https://arxiv.org/abs/2406.00827">Imbens and Xu 2024</a>, except that we will put our two plot panels side by side instead of on top of each other.</p>
<div style="max-width:800px; margin: auto;"> 
<p><img alt="" src="../_images/proj2_imbens_xu_fig3.png" /></p>
</div>
<p>We will use the experimental results as reference lines for the true ATT effect (the red lines and regions in Imbens and Xu 2024 above). We‚Äôll plot our three estimators (naive, matching, IPW) for the full observational dataset in the left panel, and our three estimators for the trimmed dataset in the right panel. As always, be sure to label the axes and add titles as appropriate. The units of the y-axis are in dollars.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load in the experimental dataset for a reference line</span>
<span class="n">experimental_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;~/COMSC-341CD/data/nsw_experimental.csv&#39;</span><span class="p">)</span>

<span class="c1"># TODO call generate_estimates for the experimental dataset using the reg_diff_in_means estimator</span>
<span class="n">experiment_results</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Figure 3: Estimator Comparison&#39;</span><span class="p">)</span>

<span class="c1">#### axs[0] ####</span>
<span class="c1"># axs[0].set_title(TODO)</span>

<span class="c1"># TODO plot the experimental point estimate as a horizontal red solid line and the 95% confidence intervals as dotted red lines</span>
<span class="c1"># Optionally, you can use ax.fill_between() to shade the 95% confidence interval region</span>
<span class="c1">#ax.hline(TODO)</span>

<span class="n">observational_estimators</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;naive difference-in-means&#39;</span><span class="p">:</span> <span class="n">naive</span><span class="p">,</span>
    <span class="s1">&#39;matched difference-in-means&#39;</span><span class="p">:</span> <span class="n">matching</span><span class="p">,</span>
    <span class="s1">&#39;IPW&#39;</span><span class="p">:</span> <span class="n">ipw</span>
<span class="p">}</span>

<span class="c1"># TODO call the build_estimator_error_bars function for the observational_estimators dictionary</span>
<span class="c1"># build_estimator_error_bars(estimator_dict=TODO, ax=TODO)</span>

<span class="c1"># fix the y-axis limits to be the same for both plots</span>
<span class="c1"># axs[0].set_ylim(-10000, 4000)</span>


<span class="c1">#### axs[1] ####</span>
<span class="c1"># TODO repeat the same plot as axs[1] for the trimmed estimators, including the experimental reference line and confidence intervals</span>
<span class="c1"># axs[1].set_title(TODO)</span>

<span class="n">trimmed_estimators</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;naive difference-in-means&#39;</span><span class="p">:</span> <span class="n">naive_trimmed</span><span class="p">,</span>
    <span class="s1">&#39;matched difference-in-means&#39;</span><span class="p">:</span> <span class="n">matching_trimmed</span><span class="p">,</span>
    <span class="s1">&#39;IPW&#39;</span><span class="p">:</span> <span class="n">ipw_trimmed</span>
<span class="p">}</span>
<span class="c1"># TODO call the build_estimator_error_bars function for the trimmed_estimators dictionary</span>
<span class="c1"># build_estimator_error_bars(estimator_dict=TODO, ax=TODO)</span>

<span class="c1"># fix the y-axis limits to be the same for both plots</span>
<span class="c1"># axs[0].set_ylim(-10000, 4000)</span>

<span class="c1"># save the figure for viewing later</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fig3_estimator_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/65e0c5aa4c5c2b9d1492fef19b4188d4e8a2f114505916832245dbfa267f4caf.png" src="../_images/65e0c5aa4c5c2b9d1492fef19b4188d4e8a2f114505916832245dbfa267f4caf.png" />
</div>
</details>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="discussion">
<h1>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h1>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If it is more convenient for you to view your notebook in one window and answer questions in another, you can copy the questions below into a separate document and answer them there. Then, you can copy your responses back into the notebook for submission.</p>
<p>The figures you generated above are also saved and embedded inline below to make it easier to answer the questions. You may need to ‚Äúrefresh‚Äù the cell by double-clicking on them and then executing the cell again to view them.</p>
</div>
<section id="id1">
<h2>2. Prior Knowledge and Causal Question<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Given the description of the NSW program above, answer the following questions:</p>
<p>2.1. Briefly discuss why the ATT may be a more appropriate causal quantity to focus on when evaluating the NSW program‚Äôs effectiveness as opposed to the ATE or ATU.</p>
<p>2.2. Suppose that the observational dataset was collected in a way such that participants self-selected into the program ‚Äì in other words, individuals voluntarily chose whether to participate in the program. The study designers then collected the list of covariates above as confounders to satisfy the conditional exchangeability assumption. Given the description of the NSW program, briefly discuss one potential confounder that might be missing from the covariate list. In your discussion, be sure to include why you believe that confounder could affect both an individual‚Äôs participation in the NSW job training program and their subsequent earnings.</p>
<div class="admonition-note admonition">
<p class="admonition-title">Note</p>
<p>The reason why the LaLonde and other researchers treat conditional exchangeability as plausible in the real data is because their ‚Äúobservational‚Äù dataset is partially constructed from the experimental dataset. Question 2.2 is operating under the assumption that the observational dataset is fully constructed from the self-selected participants, in which case conditional exchangeability would have been much more difficult to justify.</p>
</div>
<p><strong>TODO your responses</strong>:</p>
<p>2.1:</p>
<p>2.2:</p>
</section>
<section id="id2">
<h2>3. Design<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p><img alt="" src="projects/fig1_propensity_score_distribution.png" /></p>
<p><img alt="" src="projects/fig2_love_plots.png" /></p>
<p>3.1. Examining your propensity score distributions in Figure 1, does there appear to be any evidence of positivity violations? Are there any regions where the propensity score distribution may be problematic in terms of severe imbalance between the number of treated and control units?</p>
<p>3.2. Looking at the left panel Love plot for the full observational dataset in Figure 2, which covariate was the most unbalanced in the unmatched dataset, and which covariate was most balanced in the unmatched dataset? Does the matching process appear to have been effective at balancing the covariates?</p>
<p>3.3. Comment on what you observe in your right panel Love plot for the trimmed dataset in Figure 2. Does matching seem to be more beneficial for trimmed or untrimmed data?</p>
<p><strong>TODO your responses</strong>:</p>
<p>3.1:</p>
<p>3.2:</p>
<p>3.3:</p>
</section>
<section id="estimation-and-interpretation">
<h2>4. Estimation and Interpretation<a class="headerlink" href="#estimation-and-interpretation" title="Link to this heading">#</a></h2>
<p><img alt="" src="projects/fig3_estimator_comparison.png" /></p>
<p>4.1. Looking at your left panel of estimator results in Figure 3 for the full observational dataset, which estimator appears to be most biased compared to the experimental ATT estimate? Briefly discuss why you think this estimator is biased. Some things to potentially consider are what causal assumptions are being made/violated, or whether covariates are being controlled for.</p>
<p>4.2. Which estimator appears to best match the experimental ATT estimates with the full observational dataset in your left panel of Figure 3?</p>
<p>4.3. Comment on any changes you observe for all three estimators in the right panel of Figure 3 with the trimmed dataset. Which estimator(s) appear to benefit from trimming the propensity score?</p>
<p>4.4. Given that the causal quantity we have been estimating is the ATT and the experimental point estimate is $1,794, state an interpretation of this result in the context of the treatment and outcome of the study.</p>
<p><strong>TODO your responses</strong>:</p>
<p>4.1:</p>
<p>4.2:</p>
<p>4.3:</p>
<p>4.4:</p>
</section>
<section id="reflection">
<h2>5. Reflection<a class="headerlink" href="#reflection" title="Link to this heading">#</a></h2>
<p>5.1. How much time did you spend on this assignment?</p>
<p>5.2. Were there any parts of the assignment that you found particularly challenging?</p>
<p>5.3. What is one thing you have a better understanding of after completing this assignment and going through the class content?</p>
<p>5.4. Do you have any follow-up questions about concepts that you‚Äôd like to explore further?</p>
<p><strong>TODO your responses</strong>:</p>
<p>5.1:</p>
<p>5.2:</p>
<p>5.3:</p>
<p>5.4:</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="optional-extensions">
<h1>Optional Extensions<a class="headerlink" href="#optional-extensions" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>We have implemented the most fundamental matching and IPW estimators in this project. There has been extensive work on variations of these estimators, including:</p>
<ul>
<li><p>K:1 matching, where multiple controls are matched to each treated unit</p></li>
<li><p>augmented IPW, where the propensity score is augmented with a flexible model</p></li>
</ul>
</li>
<li><p>There have also been explorations of using machine learning methods to estimate the propensity score, and whether these provide better balance and/or more efficient estimators.</p></li>
<li><p>To learn more about how these variations can be implemented, see the latter sections of <a class="reference external" href="https://pmc.ncbi.nlm.nih.gov/articles/PMC3144483/pdf/hmbr46-399.pdf">Austin 2011</a> and <a class="reference external" href="https://arxiv.org/abs/2406.00827">Imbens and Xu 2024</a>.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="acknowledgements">
<h1>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading">#</a></h1>
<p>This assignment uses data from Nick Huntington-Klein‚Äôs <code class="docutils literal notranslate"><span class="pre">causaldata</span></code> package, which provides convenient access to the Lalonde dataset. This project is based on Chapter 5 of Scott Cunningham‚Äôs <a class="reference external" href="https://mixtape.scunning.com/">Causal Inference: The Mixtape</a> as well as <a class="reference external" href="https://arxiv.org/abs/2406.00827">Imbens and Xu 2024: Lalonde (1986) after Nearly Four Decades: Lessons Learned</a>.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./projects"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="proj2_functions.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Project 2 Part 1: Functions</p>
      </div>
    </a>
    <a class="right-next"
       href="proj3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Project 3 üíâ</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Project 2 Part 2: Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-table-of-contents-and-rubric">Part 2 Table of Contents and Rubric</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-and-function-imports">Notebook and function imports</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-study-effects-of-trimming">1. Simulation study: effects of trimming</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lalonde-study">The Lalonde Study</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prior-knowledge-and-causal-question">Prior Knowledge and Causal Question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation">Estimation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2. Prior Knowledge and Causal Question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">3. Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-and-interpretation">4. Estimation and Interpretation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reflection">5. Reflection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-extensions">Optional Extensions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
  Causal Inference for Data Science is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>