
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Worksheet 2 üêº &#8212; COMSC341-CD: Causal Inference for Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=a37d84e8" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'worksheets/ws2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Worksheet 3 üìä" href="ws3.html" />
    <link rel="prev" title="Worksheet 1 üé≤" href="ws1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">COMSC341-CD: Causal Inference for Data Science</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Causal Inference for Data Science
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Syllabus</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus/values.html">Goals and Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syllabus/policies.html">Course Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syllabus/schedule.html">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syllabus/office_hours.html">Office Hours</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../resources/submit.html">How to Run and Submit</a></li>


<li class="toctree-l1"><a class="reference internal" href="../resources/catalog.html">Causal Catalog</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Worksheets</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ws1.html">Worksheet 1 üé≤</a></li>






<li class="toctree-l1 current active"><a class="current reference internal" href="#">Worksheet 2 üêº</a></li>






<li class="toctree-l1"><a class="reference internal" href="ws3.html">Worksheet 3 üìä</a></li>







<li class="toctree-l1"><a class="reference internal" href="ws4.html">Worksheet 4 üìà</a></li>







<li class="toctree-l1"><a class="reference internal" href="ws5.html">Worksheet 5 üå±</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Worksheet Solutions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ws1_solution.html">WS 1 Solution üé≤</a></li>






<li class="toctree-l1"><a class="reference internal" href="ws2_solution.html">WS 2 Solution üêº</a></li>






<li class="toctree-l1"><a class="reference internal" href="ws3_solution.html">WS 3 Solution üìä</a></li>







<li class="toctree-l1"><a class="reference internal" href="ws4_solution.html">WS 4 Solution üìà</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../projects/proj1.html">Project 1 üë∂</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/proj2.html">Project 2 üë•</a></li>

<li class="toctree-l1"><a class="reference internal" href="../projects/proj3.html">Project 3 üíâ</a></li>

<li class="toctree-l1"><a class="reference internal" href="../projects/final_project.html">Final Project üåç</a></li>





</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://comsc341cd-hub-sp.mtholyoke.edu/hub/user-redirect/git-pull?repo=https%3A//github.com/comsc341cd/comsc341cd.github.io&urlpath=tree/comsc341cd.github.io/worksheets/ws2.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/worksheets/ws2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Worksheet 2 üêº</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Worksheet 2 üêº</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning Objectives</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pandas-and-tabular-data-2-pts">1. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and tabular data [2 pts]</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pandas-basics"><code class="docutils literal notranslate"><span class="pre">pandas</span></code> basics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">Data cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-assignment">Indexing and assignment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-loc-operator">the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> operator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grouping-and-transformation">Grouping and transformation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-neal-2020-1-pt">2. Reading: Neal 2020 [1 pt]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-inference-as-a-missing-data-problem-1-pt">3. Causal inference as a missing data problem [1 pt]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reflection-1-pt">4. Reflection [1 pt]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="worksheet-2">
<span id="ws2"></span><h1>Worksheet 2 üêº<a class="headerlink" href="#worksheet-2" title="Link to this heading">#</a></h1>
<blockquote class="epigraph">
<div><p>Tabular Data and Potential Outcomes</p>
<p class="attribution">‚ÄîTODO your name here</p>
</div></blockquote>
<div class="admonition-collaboration-statement admonition">
<p class="admonition-title">Collaboration Statement</p>
<ul class="simple">
<li><p>TODO brief statement on the nature of your collaboration.</p></li>
<li><p>TODO your collaborator‚Äôs names here.</p></li>
</ul>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="learning-objectives">
<h1>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Practice tabular data manipulation through pandas</p></li>
<li><p>Learn more about the potential outcomes framework for causal inference</p></li>
<li><p>Familiarization with mathematical operations on potential outcomes</p></li>
<li><p>Familiarization with Gradescope‚Äôs autograder</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before you begin
Please go to <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">-&gt;</span> <span class="pre">Clear</span> <span class="pre">Outputs</span> <span class="pre">of</span> <span class="pre">All</span> <span class="pre">Cells</span></code> so you can run the code cells yourself!</p>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="pandas-and-tabular-data-2-pts">
<h1>1. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and tabular data [2 pts]<a class="headerlink" href="#pandas-and-tabular-data-2-pts" title="Link to this heading">#</a></h1>
<p>To familiarize ourselves with working with tabular data, we will use the <a class="reference external" href="https://pandas.pydata.org/">pandas</a> library and work with the <a class="reference external" href="https://www.cdc.gov/nchs/nhanes/about/?CDC_AAref_Val=https://www.cdc.gov/nchs/nhanes/about_nhanes.htm">National Health and Nutrition Examination Survey (NHANES) dataset</a>. NHANES is a large, national survey that measures the health and nutrition of adults and children in the United States.</p>
<p>The NHANES dataset is frequently used in <strong>observational studies</strong>, where there is no intervention or manipulation of the data like a randomized experiment. We‚Äôll cover these type of studies in a few weeks. For now, we‚Äôll use pandas to answer some <strong>descriptive</strong> questions about the data.</p>
<section id="pandas-basics">
<h2><code class="docutils literal notranslate"><span class="pre">pandas</span></code> basics<a class="headerlink" href="#pandas-basics" title="Link to this heading">#</a></h2>
<p>Pandas is the defacto Python framework for working with tabular data, and it is supported by a large ecosystem of libraries, including seamless integration with numpy. Pandas provides two main data structures:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>: a 2-dimensional data structure often used to represent a table with rows and named columns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code>: a 1-dimensional, <strong>labelled</strong> array, often used to represent a single column or row in a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p></li>
</ul>
<p>Pandas dataframes allow for the datatypes of the columns to be mixed. Let‚Äôs create a couple of examples by running the code cells below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># the standard import idiom for pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a series from a list, note how there can &#39;nan&#39; (missing) values</span>
<span class="n">review_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="c1"># Note that the series can be of different data types</span>
<span class="n">review_text</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;I liked it&#39;</span><span class="p">,</span> <span class="s1">&#39;It was awful&#39;</span><span class="p">,</span> <span class="s1">&#39;Bland&#39;</span><span class="p">,</span> <span class="s1">&#39;Pretty good&#39;</span><span class="p">])</span>

<span class="c1"># pandas will automatically assign a data type (dtype) to the series</span>
<span class="n">review_scores</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    4.0
1    NaN
2    2.0
3    3.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">np.nan</span></code> is a special value in pandas that represents missing data. A critical part of the data science workflow in practice is handling missing data, as results can change dramatically when missing data is not handled properly.</p>
</div>
<p>We can then create a dataframe by passing in a dictionary of series, where the keys are the column names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;review_scores&#39;</span><span class="p">:</span> <span class="n">review_scores</span><span class="p">,</span> <span class="s1">&#39;review_text&#39;</span><span class="p">:</span> <span class="n">review_text</span><span class="p">})</span>

<span class="c1"># Print the dataframe</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>review_scores</th>
      <th>review_text</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>I liked it</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>It was awful</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>Bland</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>Pretty good</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Alternatively, we can create a dataframe from a dictionary of lists, which can sometimes be convenient:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this code produces the same dataframe as before</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;review_scores&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> 
                   <span class="s1">&#39;review_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;I liked it&#39;</span><span class="p">,</span> <span class="s1">&#39;It was awful&#39;</span><span class="p">,</span> <span class="s1">&#39;Bland&#39;</span><span class="p">,</span> <span class="s1">&#39;Pretty good&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
<p>For high-level inspection of the dataframe, we can use the following functions and attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.head()</span></code>: returns the first 5 rows of the dataframe</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.tail()</span></code>: returns the last 5 rows of the dataframe</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.info()</span></code>: returns a summary of the dataframe, including the number of rows, columns, and the data types of each column</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.columns</span></code>: returns the column names of the dataframe</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.shape</span></code>: returns the number of rows and columns in the dataframe</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.dtypes</span></code>: returns the data types of each column</p></li>
</ul>
<p>You can play around with the dataframe in the cell below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the shape is a tuple of (num rows, num columns)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4, 2)
</pre></div>
</div>
</div>
</div>
<p>Often times we‚Äôll be working with pre-existing datasets. Here, we‚Äôll use a pre-loaded version of the NHANES dataset, which is available in the <code class="docutils literal notranslate"><span class="pre">nhanes</span></code> package.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To load data from files manually, pandas provides various <code class="docutils literal notranslate"><span class="pre">pd.read_*</span></code> functions. For example, <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">pd.read_csv</a> loads (comma-separated values) CSV files. See pandas‚Äô <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html">I/O documentation</a> for more options. However, for the purposes of this worksheet, we‚Äôll use a 3rd party package to load in NHANES because it is a complex dataset.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the NHANES data and metadata using pre-built functions</span>
<span class="kn">from</span> <span class="nn">nhanes.load</span> <span class="kn">import</span> <span class="n">load_NHANES_data</span><span class="p">,</span> <span class="n">load_NHANES_metadata</span>

<span class="n">nhanes_df</span> <span class="o">=</span> <span class="n">load_NHANES_data</span><span class="p">()</span>

<span class="n">nhanes_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 8366 entries, 93703.0 to 102956.0
Columns: 197 entries, GeneralHealthCondition to TimesLost10LbsOrMoreToLoseWeight
dtypes: float64(161), object(36)
memory usage: 12.6+ MB
</pre></div>
</div>
</div>
</div>
<p>From above, we see that the dataframe has 8,366 rows and 197 columns. Here, each row represents a survey respondent, and each column represents a survey question that was asked.</p>
<p>Taking a look at the columns, we see that there are a wide range of health-related questions that were asked:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># .values returns the column names as a numpy array</span>
<span class="c1"># nhanes_df.columns.values</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-cleaning">
<h2>Data cleaning<a class="headerlink" href="#data-cleaning" title="Link to this heading">#</a></h2>
<p>To select a single column, we can square bracket indexing, as if we were acessing a dictionary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selects the &#39;GeneralHealthCondition&#39; column and prints the first 5 rows</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SEQN
93703.0          NaN
93704.0          NaN
93705.0         Good
93706.0    Very good
93707.0         Good
Name: GeneralHealthCondition, dtype: object
</pre></div>
</div>
</div>
</div>
<p>When initially exploring a dataset, it is often useful to see the unique values in a column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the unique values in the &#39;GeneralHealthCondition&#39;</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([nan, &#39;Good&#39;, &#39;Very good&#39;, &#39;Fair or&#39;, &#39;Excellent&#39;, &#39;Poor?&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Notice two things about the <code class="docutils literal notranslate"><span class="pre">GeneralHealthCondition</span></code> column:</p>
<ul class="simple">
<li><p>There are some missing values in the column, represented as <code class="docutils literal notranslate"><span class="pre">nan</span></code></p></li>
<li><p>There are two values that seem to be typos: <code class="docutils literal notranslate"><span class="pre">Poor?</span></code> and <code class="docutils literal notranslate"><span class="pre">Fair</span> <span class="pre">or</span></code></p></li>
</ul>
<p>To simplify our analysis, we can remove the rows with missing values via <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html">dropna()</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove rows with missing values in the &#39;GeneralHealthCondition&#39; column, resulting in a new dataframe</span>
<span class="n">nhanes_df</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We can also correct the typos using <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.replace.html">replace()</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace the typos with the correct values</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;Poor?&#39;</span><span class="p">:</span> <span class="s1">&#39;Poor&#39;</span><span class="p">,</span> <span class="s1">&#39;Fair or&#39;</span><span class="p">:</span> <span class="s1">&#39;Fair&#39;</span><span class="p">})</span>

<span class="c1"># print the unique values again to see the changes</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Good&#39;, &#39;Very good&#39;, &#39;Fair&#39;, &#39;Excellent&#39;, &#39;Poor&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Notice how in both operations, we reassign the result back to <code class="docutils literal notranslate"><span class="pre">nhanes_df</span></code> or a column in <code class="docutils literal notranslate"><span class="pre">nhanes_df</span></code>, which is a common pattern in pandas ‚Äì operations often return a new dataframe or column, and we need to reassign the result back to the original variable if we want to keep the changes.</p>
</div>
</section>
<section id="indexing-and-assignment">
<h2>Indexing and assignment<a class="headerlink" href="#indexing-and-assignment" title="Link to this heading">#</a></h2>
<p>The square bracket indexing can be generalized to selecting multiple columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selects multiple columns and prints the first 10 rows</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">,</span> <span class="s1">&#39;AgeInYearsAtScreening&#39;</span><span class="p">,</span> <span class="s1">&#39;SmokedAtLeast100CigarettesInLife&#39;</span><span class="p">,</span> <span class="s1">&#39;WeightKg&#39;</span><span class="p">,</span> <span class="s1">&#39;VigorousRecreationalActivities&#39;</span><span class="p">]</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GeneralHealthCondition</th>
      <th>AgeInYearsAtScreening</th>
      <th>SmokedAtLeast100CigarettesInLife</th>
      <th>WeightKg</th>
      <th>VigorousRecreationalActivities</th>
    </tr>
    <tr>
      <th>SEQN</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>93705.0</th>
      <td>Good</td>
      <td>66.0</td>
      <td>1.0</td>
      <td>79.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93706.0</th>
      <td>Very good</td>
      <td>18.0</td>
      <td>0.0</td>
      <td>66.3</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93707.0</th>
      <td>Good</td>
      <td>13.0</td>
      <td>NaN</td>
      <td>45.4</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>93708.0</th>
      <td>Good</td>
      <td>66.0</td>
      <td>0.0</td>
      <td>53.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93711.0</th>
      <td>Very good</td>
      <td>56.0</td>
      <td>0.0</td>
      <td>62.1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>93712.0</th>
      <td>Good</td>
      <td>18.0</td>
      <td>1.0</td>
      <td>58.9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>93713.0</th>
      <td>Very good</td>
      <td>67.0</td>
      <td>1.0</td>
      <td>74.9</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93714.0</th>
      <td>Good</td>
      <td>54.0</td>
      <td>1.0</td>
      <td>87.1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93715.0</th>
      <td>Fair</td>
      <td>71.0</td>
      <td>1.0</td>
      <td>65.6</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>93716.0</th>
      <td>Very good</td>
      <td>61.0</td>
      <td>1.0</td>
      <td>77.7</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Just like numpy, we can also use boolean indexing to select portions of the dataframe based on a condition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selects respondents who have smoked at least 100 cigarettes in their life</span>
<span class="n">sel_df</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">[</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;SmokedAtLeast100CigarettesInLife&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">sel_df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GeneralHealthCondition</th>
      <th>AgeInYearsAtScreening</th>
      <th>SmokedAtLeast100CigarettesInLife</th>
      <th>WeightKg</th>
      <th>VigorousRecreationalActivities</th>
    </tr>
    <tr>
      <th>SEQN</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>93705.0</th>
      <td>Good</td>
      <td>66.0</td>
      <td>1.0</td>
      <td>79.5</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93712.0</th>
      <td>Good</td>
      <td>18.0</td>
      <td>1.0</td>
      <td>58.9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>93713.0</th>
      <td>Very good</td>
      <td>67.0</td>
      <td>1.0</td>
      <td>74.9</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93714.0</th>
      <td>Good</td>
      <td>54.0</td>
      <td>1.0</td>
      <td>87.1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93715.0</th>
      <td>Fair</td>
      <td>71.0</td>
      <td>1.0</td>
      <td>65.6</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>93716.0</th>
      <td>Very good</td>
      <td>61.0</td>
      <td>1.0</td>
      <td>77.7</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>93717.0</th>
      <td>Very good</td>
      <td>22.0</td>
      <td>1.0</td>
      <td>74.4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93726.0</th>
      <td>Very good</td>
      <td>67.0</td>
      <td>1.0</td>
      <td>74.3</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93727.0</th>
      <td>Excellent</td>
      <td>70.0</td>
      <td>1.0</td>
      <td>62.7</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>93729.0</th>
      <td>Fair</td>
      <td>42.0</td>
      <td>1.0</td>
      <td>82.8</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can then use the <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> function to get the frequency of each category in a column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sel_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="c1"># normalize=True to get the proportion of each category</span>
<span class="c1"># dropna=False to include missing values as part of counts</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sel_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GeneralHealthCondition
Good         899
Fair         544
Very good    430
Excellent    126
Poor         103
Name: count, dtype: int64
GeneralHealthCondition
Good         0.427688
Fair         0.258801
Very good    0.204567
Excellent    0.059943
Poor         0.049001
Name: proportion, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Many pandas operations by default drop na values, so be careful to double check what the default behavior is!</p>
</div>
<p><strong>1.1</strong>. How would we get the general health condition proportions of respondents who have engaged in vigorous recreational activities (1 = yes, 0 = no)? Write code to do this below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO your code here</span>
</pre></div>
</div>
</div>
</div>
<p>What proportion of respondents who have engaged in vigorous recreational activities report being in excellent health?</p>
<p><strong>Your response</strong>: TODO</p>
<p>These boolean conditions can be combined using the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (AND), <code class="docutils literal notranslate"><span class="pre">|</span></code> (OR), and <code class="docutils literal notranslate"><span class="pre">~</span></code> (NOT) operators. Additionally, there are some special functions that can be used to select data based on a condition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combining conditions: respondents who are 18 or older and have engaged in vigorous recreational activities</span>
<span class="n">nhanes_df</span><span class="p">[(</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;AgeInYearsAtScreening&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;VigorousRecreationalActivities&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span> 

<span class="c1"># isin(): select rows where a column is in a list of values</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Poor?&#39;</span><span class="p">,</span> <span class="s1">&#39;Fair or&#39;</span><span class="p">])]</span>

<span class="c1"># isna(): select rows where a column is missing</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;SmokedAtLeast100CigarettesInLife&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()];</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To avoid errors, always use parentheses when combining conditions:</p>
<ul class="simple">
<li><p>Incorrect: <code class="docutils literal notranslate"><span class="pre">df[column1</span> <span class="pre">==</span> <span class="pre">value1</span> <span class="pre">&amp;</span> <span class="pre">column2</span> <span class="pre">==</span> <span class="pre">value2]</span></code></p></li>
<li><p>Correct: <code class="docutils literal notranslate"><span class="pre">df[(column1</span> <span class="pre">==</span> <span class="pre">value1)</span> <span class="pre">&amp;</span> <span class="pre">(column2</span> <span class="pre">==</span> <span class="pre">value2)]</span></code></p></li>
</ul>
</div>
<p>We can also create new columns or modify existing columns via <code class="docutils literal notranslate"><span class="pre">=</span></code> assignment (like we did with <code class="docutils literal notranslate"><span class="pre">replace()</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign a constant value to a new column where every row has the same value</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;United States&#39;</span>

<span class="c1"># Create a new column based on a condition of other columns</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;is_adult&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;AgeInYearsAtScreening&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">18</span>

<span class="c1"># Create a new column based on a function of other columns: calculate BMI</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;bmi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;WeightKg&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;StandingHeightCm&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># Print the updated dataframe</span>
<span class="n">nhanes_df</span><span class="p">[[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;is_adult&#39;</span><span class="p">,</span> <span class="s1">&#39;AgeInYearsAtScreening&#39;</span><span class="p">,</span> <span class="s1">&#39;bmi&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>is_adult</th>
      <th>AgeInYearsAtScreening</th>
      <th>bmi</th>
    </tr>
    <tr>
      <th>SEQN</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>93705.0</th>
      <td>United States</td>
      <td>True</td>
      <td>66.0</td>
      <td>31.725268</td>
    </tr>
    <tr>
      <th>93706.0</th>
      <td>United States</td>
      <td>True</td>
      <td>18.0</td>
      <td>21.476821</td>
    </tr>
    <tr>
      <th>93707.0</th>
      <td>United States</td>
      <td>False</td>
      <td>13.0</td>
      <td>18.094455</td>
    </tr>
    <tr>
      <th>93708.0</th>
      <td>United States</td>
      <td>True</td>
      <td>66.0</td>
      <td>23.714497</td>
    </tr>
    <tr>
      <th>93711.0</th>
      <td>United States</td>
      <td>True</td>
      <td>56.0</td>
      <td>21.337009</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>1.2</strong>. Let‚Äôs practice combining these operations. Select respondents who:</p>
<ul class="simple">
<li><p>are adults AND</p></li>
<li><p>report being in <code class="docutils literal notranslate"><span class="pre">Excellent</span></code> or <code class="docutils literal notranslate"><span class="pre">Very</span> <span class="pre">good</span></code> health AND</p></li>
<li><p>are NOT missing any values in the <code class="docutils literal notranslate"><span class="pre">bmi</span></code> column</p></li>
</ul>
<p>Write code to do this below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO your code here</span>
</pre></div>
</div>
</div>
</div>
<p>How many respondents are in the selected group? How many of them have smoked at least 100 cigarettes in their life?</p>
<p><strong>Your response</strong>: TODO</p>
</section>
<section id="the-loc-operator">
<h2>the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> operator<a class="headerlink" href="#the-loc-operator" title="Link to this heading">#</a></h2>
<p>In addition to square bracket indexing, pandas provides a powerful indexing method via the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.loc.html">.loc</a> operator, which allows us to select rows and columns by their labels or even boolean conditions.</p>
<p>Generally, the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> operator is used to select rows and columns by their labels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row_label</span><span class="p">,</span> <span class="n">column_label</span><span class="p">]</span>
</pre></div>
</div>
<p>The loc operator borrows from the slice notation of python lists, where we can use <code class="docutils literal notranslate"><span class="pre">:</span></code> to select all rows or column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selects all rows and the &#39;bmi&#39; column, returned as a series</span>
<span class="n">nhanes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;bmi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SEQN
93705.0    31.725268
93706.0    21.476821
93707.0    18.094455
93708.0    23.714497
93711.0    21.337009
Name: bmi, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selects all rows and the [&#39;country&#39;, &#39;is_adult&#39;, &#39;bmi&#39;] columns</span>
<span class="c1"># Note that the columns are wrapped in a list!</span>
<span class="n">nhanes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;is_adult&#39;</span><span class="p">,</span> <span class="s1">&#39;bmi&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>is_adult</th>
      <th>bmi</th>
    </tr>
    <tr>
      <th>SEQN</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>93705.0</th>
      <td>United States</td>
      <td>True</td>
      <td>31.725268</td>
    </tr>
    <tr>
      <th>93706.0</th>
      <td>United States</td>
      <td>True</td>
      <td>21.476821</td>
    </tr>
    <tr>
      <th>93707.0</th>
      <td>United States</td>
      <td>False</td>
      <td>18.094455</td>
    </tr>
    <tr>
      <th>93708.0</th>
      <td>United States</td>
      <td>True</td>
      <td>23.714497</td>
    </tr>
    <tr>
      <th>93711.0</th>
      <td>United States</td>
      <td>True</td>
      <td>21.337009</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Where the .loc operator becomes useful is when we want to compactly select rows and columns based on a condition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selects rows where the &#39;bmi&#39; column is greater than 25, and returns the &#39;bmi&#39; and &#39;is_adult&#39; columns</span>
<span class="n">nhanes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;bmi&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bmi&#39;</span><span class="p">,</span> <span class="s1">&#39;is_adult&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bmi</th>
      <th>is_adult</th>
    </tr>
    <tr>
      <th>SEQN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>93705.0</th>
      <td>31.725268</td>
      <td>True</td>
    </tr>
    <tr>
      <th>93714.0</th>
      <td>39.872116</td>
      <td>True</td>
    </tr>
    <tr>
      <th>93716.0</th>
      <td>30.657370</td>
      <td>True</td>
    </tr>
    <tr>
      <th>93719.0</th>
      <td>26.009064</td>
      <td>False</td>
    </tr>
    <tr>
      <th>93721.0</th>
      <td>35.882948</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This selection can be used to modify columns based on a condition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the &#39;bmi&#39; column to np.nan for all rows where the &#39;is_adult&#39; column is False</span>
<span class="n">nhanes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nhanes_df</span><span class="p">[</span><span class="s1">&#39;is_adult&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;bmi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># print the updated dataframe</span>
<span class="n">nhanes_df</span><span class="p">[[</span><span class="s1">&#39;bmi&#39;</span><span class="p">,</span> <span class="s1">&#39;is_adult&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bmi</th>
      <th>is_adult</th>
    </tr>
    <tr>
      <th>SEQN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>93705.0</th>
      <td>31.725268</td>
      <td>True</td>
    </tr>
    <tr>
      <th>93706.0</th>
      <td>21.476821</td>
      <td>True</td>
    </tr>
    <tr>
      <th>93707.0</th>
      <td>NaN</td>
      <td>False</td>
    </tr>
    <tr>
      <th>93708.0</th>
      <td>23.714497</td>
      <td>True</td>
    </tr>
    <tr>
      <th>93711.0</th>
      <td>21.337009</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>1.3.</strong> Common age cutoffs that are used in health policy studies are 18 and 65 ‚Äì 18 is when people are legally considered adults in the United States, and 65 is when they are eligible for Medicare health insurance. Create a new column <code class="docutils literal notranslate"><span class="pre">age_category</span></code> using the <code class="docutils literal notranslate"><span class="pre">AgeInYearsAtScreening</span></code> column and the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> operator that makes the following assignments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'child'</span></code>: age &lt; 18</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'adult'</span></code>: 18 &lt;= age &lt; 65</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'senior'</span></code>: age &gt;= 65</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO your code here</span>
</pre></div>
</div>
</div>
</div>
<p>How many respondents are in the ‚Äòsenior‚Äô age category?</p>
<p><strong>Your response</strong>: TODO</p>
</section>
<section id="grouping-and-transformation">
<h2>Grouping and transformation<a class="headerlink" href="#grouping-and-transformation" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html">groupby()</a> function is a powerful tool for performing aggregations on subsets of the dataframe. We pass in one or more columns as the <code class="docutils literal notranslate"><span class="pre">by</span></code> argument, which then divides the original Dataframe based on the unique values of the column(s). We then often apply an <strong>aggregation</strong> function to each group, resulting in a new dataframe.</p>
<p>We can replicate <code class="docutils literal notranslate"><span class="pre">value_counts()</span></code> with <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> and the <code class="docutils literal notranslate"><span class="pre">size()</span></code> aggregation function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count number of people in each health condition category</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GeneralHealthCondition
Excellent     619
Fair         1175
Good         2454
Poor          172
Very good    1544
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>We can also compute summary statistics like <code class="docutils literal notranslate"><span class="pre">mean()</span></code>, <code class="docutils literal notranslate"><span class="pre">std()</span></code>, <code class="docutils literal notranslate"><span class="pre">median()</span></code>, <code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code> on each group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean BMI by general health condition</span>
<span class="n">nhanes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">)[</span><span class="s1">&#39;bmi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GeneralHealthCondition
Excellent    26.518102
Fair         31.889146
Good         30.176114
Poor         34.366233
Very good    27.744468
Name: bmi, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>We can also group by multiple columns, which then groups the dataframe by the unique cross-product of the columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean BMI by general health condition and vigorous recreational activities</span>
<span class="c1"># as_index=False keeps the groupby columns as columns in the resulting dataframe</span>
<span class="n">nhanes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">,</span> <span class="s1">&#39;VigorousRecreationalActivities&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;bmi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GeneralHealthCondition</th>
      <th>VigorousRecreationalActivities</th>
      <th>bmi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Excellent</td>
      <td>0.0</td>
      <td>27.303422</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Excellent</td>
      <td>1.0</td>
      <td>25.496384</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Fair</td>
      <td>0.0</td>
      <td>31.804008</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fair</td>
      <td>1.0</td>
      <td>32.433563</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Good</td>
      <td>0.0</td>
      <td>30.266370</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Good</td>
      <td>1.0</td>
      <td>29.861264</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Poor</td>
      <td>0.0</td>
      <td>34.507856</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Poor</td>
      <td>1.0</td>
      <td>31.169604</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Very good</td>
      <td>0.0</td>
      <td>28.349808</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Very good</td>
      <td>1.0</td>
      <td>26.684116</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To apply multiple aggregation functions, we can pass in a dictionary of columns as keys and functions as values to <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.agg.html">agg()</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean, min, max for BMI and median household income by general health condition</span>
<span class="n">nhanes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;bmi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">],</span> <span class="s1">&#39;AnnualHouseholdIncome&#39;</span><span class="p">:</span> <span class="s1">&#39;median&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">bmi</th>
      <th>AnnualHouseholdIncome</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>min</th>
      <th>max</th>
      <th>median</th>
    </tr>
    <tr>
      <th>GeneralHealthCondition</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Excellent</th>
      <td>26.518102</td>
      <td>16.111752</td>
      <td>57.266546</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>Fair</th>
      <td>31.889146</td>
      <td>15.469697</td>
      <td>72.555993</td>
      <td>30000.0</td>
    </tr>
    <tr>
      <th>Good</th>
      <td>30.176114</td>
      <td>15.455268</td>
      <td>86.160237</td>
      <td>50000.0</td>
    </tr>
    <tr>
      <th>Poor</th>
      <td>34.366233</td>
      <td>14.910611</td>
      <td>84.404111</td>
      <td>30000.0</td>
    </tr>
    <tr>
      <th>Very good</th>
      <td>27.744468</td>
      <td>14.818824</td>
      <td>57.689838</td>
      <td>60000.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>1.4</strong>. Generate a table that groups by:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GeneralHealthCondition</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SmokedAtLeast100CigarettesInLife</span></code></p></li>
</ul>
<p>and calculates the mean of the following columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">EverToldYouHavePrediabetes</span></code>: 0 = no, 1 = yes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EverToldYouHadHeartAttack</span></code>: 0 = no, 1 = yes</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The mean of a binary column is equivalent to the proportion of 1s in the column.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO your code here</span>
</pre></div>
</div>
</div>
</div>
<p>Which subgroup of health conditions and smoking status has the highest proportion of people who have been told they have had a heart attack?</p>
<p><strong>Your response</strong>: TODO</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more on pandas operations, see <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/10min.html">this quickstart guide</a> and the associated links within it.</p>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="reading-neal-2020-1-pt">
<h1>2. Reading: Neal 2020 [1 pt]<a class="headerlink" href="#reading-neal-2020-1-pt" title="Link to this heading">#</a></h1>
<p>Read the following sections of <a class="reference external" href="https://www.bradyneal.com/Introduction_to_Causal_Inference-Dec17_2020-Neal.pdf">Neal 2020: An Introduction to Causal Inference</a> and answer the questions below:</p>
<ul class="simple">
<li><p>Sections 2.1 - 2.3.2</p></li>
<li><p>Section 2.3.5</p></li>
</ul>
<div class="admonition-reading-notes admonition">
<p class="admonition-title">Reading Notes</p>
<ul class="simple">
<li><p>Don‚Äôt worry too much about the causal graphs shown in the margin, as we‚Äôll cover causal graph formalisms in upcoming classes.</p></li>
<li><p>The notation <span class="math notranslate nohighlight">\(\triangleq\)</span> is used to denote ‚Äúis defined as‚Äù. For example, Equation 2.1 <span class="math notranslate nohighlight">\(\tau_i \triangleq Y_i(1) - Y_i(0)\)</span> means that the individual treatment effect for unit <span class="math notranslate nohighlight">\(i\)</span> is defined as <span class="math notranslate nohighlight">\(Y_i(1) - Y_i(0)\)</span>.</p></li>
<li><p>A mathematical identity we‚Äôll need for the derivations is <strong>linearity of expectation</strong>. This states that for <em>any</em> random variables <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> and constant <span class="math notranslate nohighlight">\(a\)</span>:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
E[X + Y] = E[X] + E[Y]
\]</div>
<div class="math notranslate nohighlight">
\[
E[aX] = aE[X]
\]</div>
<ul class="simple">
<li><p>Implications of two variables <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> being independent (written <span class="math notranslate nohighlight">\(X \perp Y\)</span>) are that:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
E[X | Y=y] = E[X]
\]</div>
<div class="math notranslate nohighlight">
\[
E[XY] = E[X]E[Y]
\]</div>
<ul class="simple">
<li><p>The consistency assumption (Assumption 2.5) allows us to define the observed outcome <span class="math notranslate nohighlight">\(Y\)</span> with binary treatment <span class="math notranslate nohighlight">\(T\)</span> as follows:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
Y = T \cdot Y(1) + (1-T) \cdot Y(0)
\]</div>
</div>
<p><strong>2.1.</strong> State the fundamental problem of causal inference in your own words.</p>
<p><strong>Your Response</strong>: TODO</p>
<p><strong>2.2.</strong> These sections of Neal 2020 cover three key assumptions that allow us to <strong>identify</strong> (definition 2.1, p. 10) the average treatment effect (ATE) of a binary treatment:</p>
<ul class="simple">
<li><p>ignorability / exchangeability (Assumption 2.1, p. 9)</p></li>
<li><p>no interference (Assumption 2.4, p. 13)</p></li>
<li><p>consistency (Assumption 2.5, p. 14)</p></li>
</ul>
<p>Below is a restatement of the ATE derivation. State which mathematical identities and assumptions are used on each line:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
ATE &amp;= E[Y(1) - Y(0)]\\
    &amp;= E[Y(1)] ‚àí E[Y(0)], \text{ from TODO} \\
    &amp;= E[Y(1) | T = 1] ‚àí E[Y(0) | T = 0], \text{ from TODO} \\
    &amp;= E[Y | T = 1] ‚àí E[Y | T = 0] \text{ from TODO}
\end{split}\]</div>
<p><strong>2.3.</strong> The no interference assumption states that the potential outcomes for one unit are unaffected by the treatment assignment of other units. Breaking down Neal‚Äôs example on p. 13, suppose that you are unit 1 and your friend is unit 2. If your friend gets a dog (<span class="math notranslate nohighlight">\(t_2 = 1\)</span>), we can then examine your potential outcomes:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
&amp;Y_1(t_1, t_2), \text{ potential outcomes for unit 1} \\ 
&amp;Y_1(0, 1), \text{ you don't get a dog, but your friend does} \\
&amp;Y_1(1, 1), \text{ you and your friend get a dog}
\end{split}\]</div>
<p>The argument is that it is likely that the potential outcomes for your happiness are affected by your friend‚Äôs choice to get a dog: perhaps you‚Äôll already be happier if your friend gets a dog because you get to play with them, or perhaps you‚Äôre allergic to dogs so you have to see your friend less often, etc. This leads to a violation of the no interference assumption where your potential outcomes are no longer just a function of your own treatment assignment <span class="math notranslate nohighlight">\(t_1\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
Y_1(0, 1) \neq Y_1(0) \\
Y_1(1, 1) \neq Y_1(1)
\end{split}\]</div>
<p>Neal then states that ‚Äúviolations of the no interference assumption are rampant in network data,‚Äù e.g. friend groups like the dog example above, social networks, or transportation networks (think roads, subway lines, airports). Give an example of a setting along with a treatment <span class="math notranslate nohighlight">\(T\)</span> and outcome <span class="math notranslate nohighlight">\(Y\)</span> where you think the no interference assumption is likely to be violated.</p>
<p><strong>Your Response</strong>:</p>
<ul class="simple">
<li><p>Treatment: TODO</p></li>
<li><p>Outcome: TODO</p></li>
<li><p>Reasoning: TODO</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="causal-inference-as-a-missing-data-problem-1-pt">
<h1>3. Causal inference as a missing data problem [1 pt]<a class="headerlink" href="#causal-inference-as-a-missing-data-problem-1-pt" title="Link to this heading">#</a></h1>
<p>Let‚Äôs now put the conceptual ideas around potential outcomes together with our table manipulation practice in pandas.</p>
<p>Our framework for causal inference is that there is there is a causal ‚Äúground truth‚Äù table of potential outcomes for each unit. With our example from class, we might be interested in studying the effect of taking aspirin <span class="math notranslate nohighlight">\(T\)</span> (<span class="math notranslate nohighlight">\(T=1\)</span> means taking aspirin, <span class="math notranslate nohighlight">\(T=0\)</span> means not taking aspirin) on headaches <span class="math notranslate nohighlight">\(Y\)</span> (<span class="math notranslate nohighlight">\(Y=1\)</span> means having a headache, <span class="math notranslate nohighlight">\(Y=0\)</span> means not having a headache). The potential outcomes then correspond to:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
Y(0) = \text{what the outcome } \textit{would have been} \text{ if } T = 0 \\
Y(1) = \text{what the outcome } \textit{would have been} \text{ if } T = 1
\end{split}\]</div>
<p>We then have a table of potential outcomes for each unit, where each row is a unit and each column is a potential outcome:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{c|c|c|c}
\text{Unit } i &amp; T &amp; Y(0) &amp; Y(1) \\
\hline
1 &amp; 0 &amp; 1 &amp; 1 \\
2 &amp; 1 &amp; 1 &amp; 0 \\
3 &amp; 0 &amp; 1 &amp; 0 \\
4 &amp; 1 &amp; 0 &amp; 0 \\
\end{array}
\end{split}\]</div>
<p>The problem is that we are not omniscient, nor do we have a time machine, so we only observe one realized outcome <span class="math notranslate nohighlight">\(Y\)</span> for each unit. There are thus missing values in the table of the data we actually observe:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{c|c|c|c|c}
\text{Unit } i &amp; T &amp; Y(0) &amp; Y(1) &amp; Y \\
\hline
1 &amp; 0 &amp; 1 &amp; \text{nan} &amp; 1 \\
2 &amp; 1 &amp; \text{nan} &amp; 0 &amp; 0 \\
3 &amp; 0 &amp; 1 &amp; \text{nan} &amp; 1 \\
4 &amp; 1 &amp; \text{nan} &amp; 0 &amp; 0 \\
\end{array}
\end{split}\]</div>
<p>The challenge in causal inference is to try to construct causal estimates when we only have the observed data. Throughout this course we‚Äôll use our ability to simulate different data generating processes in code to understand the properties of causal inference methods, and when they can or cannot identify the causal effect.</p>
<p>We‚Äôll start by writing a utility function that takes treatment assignments and a ground truth table of potential outcomes, and generates the realized outcomes.</p>
<div class="tip admonition">
<p class="admonition-title">Hint</p>
<p>To construct the observed outcome <span class="math notranslate nohighlight">\(Y\)</span>, look to how we defined <span class="math notranslate nohighlight">\(Y\)</span> under the consistency assumption.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_observed_df</span><span class="p">(</span><span class="n">po_df</span><span class="p">,</span> <span class="n">treatments</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dataframe of realized outcomes from a ground truth table of potential outcomes and treatment assignments.</span>
<span class="sd">    The unobserved potential outcomes are set to np.nan.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        po_df (pd.DataFrame): a dataframe of potential outcomes with columns &#39;Y0&#39; and &#39;Y1&#39;</span>
<span class="sd">        treatments (pd.Series): a series of treatment assignments with the same length as po_df</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: a dataframe of realized outcomes with columns &#39;T&#39;, &#39;Y0&#39;, &#39;Y1&#39;, and &#39;Y&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">po_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">treatments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;The number of rows in po_df and treatments must match&quot;</span>
    
    <span class="c1"># TODO your code here</span>
    <span class="n">observed_df</span> <span class="o">=</span> <span class="n">po_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">observed_df</span>

<span class="c1"># Generate some simple test data, matching the example above</span>
<span class="n">treatments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">po_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Y0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Y1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]})</span>
<span class="n">observed_df</span> <span class="o">=</span> <span class="n">generate_observed_df</span><span class="p">(</span><span class="n">po_df</span><span class="p">,</span> <span class="n">treatments</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">in</span> <span class="n">observed_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;The observed dataframe does not have a &#39;Y&#39; column&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">line</span> <span class="mi">24</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">po_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Y0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Y1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]})</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="n">observed_df</span> <span class="o">=</span> <span class="n">generate_observed_df</span><span class="p">(</span><span class="n">po_df</span><span class="p">,</span> <span class="n">treatments</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">24</span> <span class="k">assert</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">in</span> <span class="n">observed_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;The observed dataframe does not have a &#39;Y&#39; column&quot;</span>

<span class="ne">AssertionError</span>: The observed dataframe does not have a &#39;Y&#39; column
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is the first auto-graded function in the course ‚Äì there will be no submission limit so feel free to try multiple times. We will frequently provide some simple test cases via <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements to check your function. The syntax for assert statements is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">bool_expression</span><span class="p">,</span> <span class="n">description</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">bool_expression</span></code> is a boolean expression that tests some condition, and the <code class="docutils literal notranslate"><span class="pre">description</span></code> is a string that will be displayed if the assertion fails (evaluates to <code class="docutils literal notranslate"><span class="pre">False</span></code>).</p>
<p>You are encouraged to write your own test cases as well for your functions!</p>
</div>
<div class="admonition-takeaway admonition">
<p class="admonition-title">Takeaway</p>
<p>This transformation from the ground truth table of potential outcomes to the observed data is a key step in thinking about causal quantities. <strong>If only</strong> we had the ground truth table, we could directly estimate quantities like <span class="math notranslate nohighlight">\(E[Y(1)]\)</span> and <span class="math notranslate nohighlight">\(E[Y(0)]\)</span>. However, since we only have the observed data, we need to make assumptions, like the ones covered in the Neal reading, in order to ‚Äúreconstruct‚Äù those quantities. This is the process of <strong>identifying</strong> the causal effect. See the figure below:</p>
<figure class="align-default" id="potential-outcomes-to-observed">
<a class="reference internal image-reference" href="../_images/ws2_hernan_fig_1_1.png"><img alt="../_images/ws2_hernan_fig_1_1.png" src="../_images/ws2_hernan_fig_1_1.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Adapted from Hern√°n and Robins 2020 1.1</span><a class="headerlink" href="#potential-outcomes-to-observed" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>We saw from the Neal reading that the assumptions made in a randomized experiment allow for us to identify the causal effect, i.e. reconstruct <span class="math notranslate nohighlight">\(E[Y(1)]\)</span> from <span class="math notranslate nohighlight">\(E[Y|T=1]\)</span>, and <span class="math notranslate nohighlight">\(E[Y(0)]\)</span> from <span class="math notranslate nohighlight">\(E[Y|T=0]\)</span>.
You may sometimes hear that ‚Äúassociation is causation, in a randomized experiment.‚Äù</p>
<p>The crux of the ‚Äúdesign‚Äù step in the causal roadmap generally involves evaluating what assumptions we need in order to perform identification, and whether those assumptions are reasonable to make.</p>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="reflection-1-pt">
<h1>4. Reflection [1 pt]<a class="headerlink" href="#reflection-1-pt" title="Link to this heading">#</a></h1>
<p><strong>4.1</strong> How much time did it take you to complete this worksheet? How long did it take you to read the selected sections of Neal 2020?</p>
<p><strong>Your Response</strong>: TODO</p>
<p><strong>4.2</strong> What is one thing you have a better understanding of after completing this worksheet and going though the class content this week? This could be about the concepts, the reading, or the code.</p>
<p><strong>Your Response</strong>: TODO</p>
<p><strong>4.3</strong> What questions or points of confusion do you have about the material covered in the past week of class?</p>
<p><strong>Your Response</strong>: TODO</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don‚Äôt forget to check that all of the TODOs are filled in before you submit!</p>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="acknowledgements">
<h1>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading">#</a></h1>
<p>Portions of this worksheet are adapted from Bhargavi‚Äôs study notes on pandas. This worksheet also uses Russ Poldrack‚Äôs <a class="reference external" href="https://github.com/poldrack/nhanes">nhanes package</a>, which processes the NHANES dataset into a convenient pandas dataframe.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./worksheets"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ws1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Worksheet 1 üé≤</p>
      </div>
    </a>
    <a class="right-next"
       href="ws3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Worksheet 3 üìä</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Worksheet 2 üêº</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning Objectives</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pandas-and-tabular-data-2-pts">1. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and tabular data [2 pts]</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pandas-basics"><code class="docutils literal notranslate"><span class="pre">pandas</span></code> basics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">Data cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-assignment">Indexing and assignment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-loc-operator">the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> operator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grouping-and-transformation">Grouping and transformation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-neal-2020-1-pt">2. Reading: Neal 2020 [1 pt]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-inference-as-a-missing-data-problem-1-pt">3. Causal inference as a missing data problem [1 pt]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#reflection-1-pt">4. Reflection [1 pt]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
  Causal Inference for Data Science is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>